<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gene Signatures • VISION</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Gene Signatures">
<meta property="og:description" content="VISION">
<meta property="og:image" content="https://yoseflab.github.io/VISION/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">VISION</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/VISION-vignette.html">Getting Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Signatures.html">Gene Signatures</a>
    </li>
    <li>
      <a href="../articles/web_only/SignatureAutocorrelation.html">Signature Autocorrelation</a>
    </li>
    <li>
      <a href="../articles/micropooling.html">Micropooling</a>
    </li>
    <li>
      <a href="../articles/trajectories.html">Incorporating a Trajectory Model</a>
    </li>
    <li>
      <a href="../articles/phyloVision.html">PhyloVision and Hotspot</a>
    </li>
    <li>
      <a href="../articles/spatialHotspot.html">Spatial Data and Hotspot</a>
    </li>
    <li>
      <a href="../articles/web_only/Seurat.html">How To: Working with Seurat</a>
    </li>
    <li>
      <a href="../articles/web_only/10xData.html">How To: 10x CellRanger Outputs</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/YosefLab/VISION/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Signatures_files/header-attrs-2.8/header-attrs.js"></script><script src="Signatures_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Gene Signatures</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/YosefLab/VISION/blob/master/vignettes/Signatures.Rmd"><code>vignettes/Signatures.Rmd</code></a></small>
      <div class="hidden name"><code>Signatures.Rmd</code></div>

    </div>

    
    
<div id="what-is-a-signature" class="section level1">
<h1 class="hasAnchor">
<a href="#what-is-a-signature" class="anchor"></a>What is a Signature?</h1>
<p>A gene signature is a set of genes involved in some biological process.</p>
<p>Signatures come in two flavors:</p>
<ul>
<li>
<strong>Unsigned</strong> - A set of genes that have some common annotation. For example, genes involved in a pathway of interest. These signatures commonly derive from manual annotation approaches These signatures commonly derive from manual annotation approaches.</li>
<li>
<strong>Signed</strong> - A set of genes which describes the <em>contrast</em> between two conditions. Signed signatures compare condition A vs. condition B and have a set of ‘positive’ genes which are increased in A (compared to B) and a set of ‘negative’ genes which are decreased in A (compared to B). Signed signatures are often defined computationally as the result of a differential expression test in some previous experiment.</li>
</ul>
</div>
<div id="where-to-find-signatures" class="section level1">
<h1 class="hasAnchor">
<a href="#where-to-find-signatures" class="anchor"></a>Where to find Signatures</h1>
<p>A great resource for gene signatures is <strong>MSigDB</strong>, curated by the Broad institute. Signatures can be browsed, searched and downloaded from <a href="http://software.broadinstitute.org/gsea/msigdb/">here</a> as .gmt files, then provided to VISION to be included in the analysis.</p>
<p>Alternately, many signature libraries in .gmt format are available through <strong><a href="http://amp.pharm.mssm.edu/Enrichr">Enrichr</a></strong> on their <a href="http://amp.pharm.mssm.edu/Enrichr/#stats">“Libraries”</a> page.</p>
<p>Finally, if you have your own lists of genes, you can define you own signatures following the instructions below.</p>
</div>
<div id="creating-signatures-manually" class="section level1">
<h1 class="hasAnchor">
<a href="#creating-signatures-manually" class="anchor"></a>Creating Signatures Manually</h1>
<p>If there is a set of proprietary genes of interest, a user-defined signature can be created in two ways:</p>
<div id="creating-a-signature-object-in-r" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-a-signature-object-in-r" class="anchor"></a>1. Creating a Signature object in R</h2>
<p>Once a set of genes that are up or down regulated in the process or cell type of interest are selected, creating a Signature object from them is relatively straightforward:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sigData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    Gene.A <span class="op">=</span> <span class="fl">1</span>, Gene.B <span class="op">=</span> <span class="fl">1</span>, Gene.C <span class="op">=</span> <span class="fl">1</span>,
    Gene.D <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, Gene.B <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, Gene.C <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>
<span class="op">)</span>

<span class="va">sig</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createGeneSignature.html">createGeneSignature</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Interesting Process"</span>, sigData <span class="op">=</span> <span class="va">sigData</span><span class="op">)</span></code></pre></div>
<p>For the sigData vector, the names represent gene names and the values (1 or -1) represent the ‘sign’ of the gene. For an unsigned signature, just use 1 for the value of every gene.</p>
<p>A list of these sig objects can then be passed into the VISION object constructor instead of paths to .gmt files.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sig1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createGeneSignature.html">createGeneSignature</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Interesting Process"</span>, <span class="va">...</span> <span class="op">)</span>
<span class="va">sig2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createGeneSignature.html">createGeneSignature</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Another Interesting Process"</span>, <span class="va">...</span> <span class="op">)</span>

<span class="va">mySignatures</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sig1</span>, <span class="va">sig2</span><span class="op">)</span>

<span class="va">vis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Vision.html">Vision</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">expressionMat</span>, signatures <span class="op">=</span> <span class="va">mySignatures</span><span class="op">)</span></code></pre></div>
<p>Additionally, you can mix and match user-created signatures and paths to signature files in the <code>signatures</code> argument. When doing this, signatures in each library file are read and combined with the user-created signatures.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sig1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createGeneSignature.html">createGeneSignature</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Interesting Process"</span>, <span class="va">...</span> <span class="op">)</span>
<span class="va">sig2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createGeneSignature.html">createGeneSignature</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Another Interesting Process"</span>, <span class="va">...</span> <span class="op">)</span>

<span class="va">mySignatures</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sig1</span>, <span class="va">sig2</span>, <span class="st">'path/to/some/library.gmt'</span><span class="op">)</span>

<span class="va">vis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Vision.html">Vision</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">expressionMat</span>, signatures <span class="op">=</span> <span class="va">mySignatures</span><span class="op">)</span></code></pre></div>
</div>
<div id="create-your-own--gmt-files" class="section level2">
<h2 class="hasAnchor">
<a href="#create-your-own--gmt-files" class="anchor"></a>2. Create your own .gmt files</h2>
<p>Signature files are supported in the .gmt format - a textual format which is easy to create and view</p>
<p>The file is tab-delimited and contains one signature per line, (however ‘positive’ and ‘negative’ genes are split into two lines)</p>
<p>Each line should look like this:</p>
<pre><code>&lt;Signature Name&gt; TAB &lt;Signature Description&gt; TAB &lt;Gene1&gt; TAB &lt;Gene2&gt; … (etc)</code></pre>
<p>To denote signed signatures, use two lines to show the signature, with the “positive” genes in one line and the “negative” genes in the other. Add "_plus" to the signature name on the line with the positive genes and "_minus" to the signature name on the line with the negative genes.</p>
<p>For example:</p>
<pre><code>MEMORY_VS_NAIVE_CD8_TCELL_plus    GSE16522   RHOC    OFD1     MLF1   ...
MEMORY_VS_NAIVE_CD8_TCELL_minus   GSE16522   PTPRK   S100A5   IL1A   ...
BCELL_VS_LUPUS_BCELL_plus         GSE10325   OXT     KCNH2    BTBD7  ...
BCELL_VS_LUPUS_BCELL_minus        GSE10325   VAMP5   WSB2     CCR2   ...</code></pre>
</div>
</div>
<div id="signature-scores" class="section level1">
<h1 class="hasAnchor">
<a href="#signature-scores" class="anchor"></a>Signature Scores</h1>
<p>For each signature an overall measure of expression is evaluated for each cell as the <em>Signature Score</em>. This is computed as:</p>
<p><span class="math display">\[ s_j = \frac{1}{|G_{pos}| + |G_{neg}} \Bigg(\sum_{g \in G_{pos}}{X_{gj}} - \sum_{g \in G_{neg}}{X_{gj}}\Bigg) \]</span></p>
<p>Where:</p>
<ul>
<li>
<span class="math inline">\(s_j\)</span> is the signature score in cell <em>j</em>
</li>
<li>
<span class="math inline">\(X_{gj}\)</span> is the <em>log</em>, <em>scaled</em> expression of gene <em>g</em> in cell <em>j</em>
</li>
<li>
<span class="math inline">\(G_{pos}\)</span> and <span class="math inline">\(G_{neg}\)</span> are the set of ‘positive’ and ‘negative’ signature genes respectively</li>
</ul>
<p>VISION expects the input expression data to already be scaled (i.e., the gene counts in each cell are divided by the total number of counts in the cell and multiplied by some constant such as 10,000 or the median number of UMI across cells) and normalized (significant technical confounders regressed-out). Internally, VISION additionally log-transforms (<span class="math inline">\(log_2(x+1)\)</span>) the expression data to compress the dynamic range. This is done so that genes which are naturally expressed at higher magnitudes don’t dominate the signature score as heavily.</p>
<p>However, with just the above formulation, we have observed that depending on the scaling or normalization method, signature scores can still be highly correlated with cell-level metrics such as the number of UMI per cell. To account for this, we note that the expected value of a randomly-drawn signature in cell <em>j</em> is:</p>
<p><span class="math display">\[ \frac{|G_{pos}| - |G_{neg}|}{|G_{pos}| + |G_{neg}|} \bar{X_j} \]</span></p>
<p>And the expected variance of a random signature score is:</p>
<p><span class="math display">\[ \frac{var(X_j)}{|G_{pos}| + |G_{neg}|} \]</span></p>
<p>Therefore we can remove global cell-specific distributional effects from the signature scores by first Z-normalizing the expression data, <span class="math inline">\(X_j\)</span>, within each cell (so that <span class="math inline">\(\bar{X_j}\)</span> is 0 and <span class="math inline">\(var(X_j)\)</span> is 1) prior to calculating signature scores as defined above. This is the default operation performed by VISION (controlled through the <code>sig_norm_method</code> parameter).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Matt Jones, David Detomaso, Tal Ashuach, Yanay Rosen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
