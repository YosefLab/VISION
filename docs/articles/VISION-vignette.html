<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to VISION • VISION</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Introduction to VISION">
<meta property="og:description" content="VISION">
<meta property="og:image" content="https://yoseflab.github.io/VISION/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">VISION</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/VISION-vignette.html">Getting Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Signatures.html">Gene Signatures</a>
    </li>
    <li>
      <a href="../articles/web_only/SignatureAutocorrelation.html">Signature Autocorrelation</a>
    </li>
    <li>
      <a href="../articles/micropooling.html">Micropooling</a>
    </li>
    <li>
      <a href="../articles/trajectories.html">Incorporating a Trajectory Model</a>
    </li>
    <li>
      <a href="../articles/phyloVision.html">PhyloVision and Hotspot</a>
    </li>
    <li>
      <a href="../articles/spatialHotspot.html">Spatial Data and Hotspot</a>
    </li>
    <li>
      <a href="../articles/web_only/Seurat.html">How To: Working with Seurat</a>
    </li>
    <li>
      <a href="../articles/web_only/10xData.html">How To: 10x CellRanger Outputs</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/YosefLab/VISION/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="VISION-vignette_files/header-attrs-2.8/header-attrs.js"></script><script src="VISION-vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to VISION</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/YosefLab/VISION/blob/master/vignettes/VISION-vignette.Rmd"><code>vignettes/VISION-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>VISION-vignette.Rmd</code></div>

    </div>

    
    
<div id="preliminaries" class="section level1">
<h1 class="hasAnchor">
<a href="#preliminaries" class="anchor"></a>Preliminaries</h1>
<p>If you have yet to install VISION, we recommend installing the package from Github to install this package. Full source code can be found at the VISION Github repository, available <a href="http://www.github.com/YosefLab/VISION">here</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/">devtools</a></span><span class="op">)</span>
<span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"YosefLab/VISION"</span><span class="op">)</span></code></pre></div>
<p>Once VISION and R are installed, you may load in VISION using <code><a href="https://yoseflab.github.io/VISION">library(VISION)</a></code>.</p>
</div>
<div id="using-vision" class="section level1">
<h1 class="hasAnchor">
<a href="#using-vision" class="anchor"></a>Using VISION</h1>
<p>Running an analysis with vision consists of three steps:</p>
<ol style="list-style-type: decimal">
<li>Creating the VISION object</li>
<li>Running the <code>analyze</code> function</li>
<li>Browsing results</li>
</ol>
<div id="creating-the-vision-object" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-the-vision-object" class="anchor"></a>Creating the VISION object</h2>
<p>Creating the VISION object requires a gene expression matrix and <em>either</em> a list of Gene Signatures or a data.frame of meta-data.</p>
<p>In this example - both are provided.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load VISION</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yoseflab.github.io/VISION">VISION</a></span><span class="op">)</span>

<span class="co"># Read in expression counts (Genes X Cells)</span>
<span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"data/expression_counts.txt.gz"</span>,
                     header <span class="op">=</span> <span class="cn">TRUE</span>,
                     sep <span class="op">=</span> <span class="st">'\t'</span>,
                     row.names <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="co"># Scale counts within a sample</span>
<span class="va">n.umi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span>

<span class="va">scaled_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span> <span class="op">/</span> <span class="va">n.umi</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">n.umi</span><span class="op">)</span>

<span class="co"># Read in meta data (Cells x Vars)</span>
<span class="va">meta</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"data/glio_meta.txt.gz"</span>, sep<span class="op">=</span><span class="st">'\t'</span>, header<span class="op">=</span><span class="cn">T</span>, row.names<span class="op">=</span><span class="fl">1</span><span class="op">)</span>

<span class="va">vis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Vision.html">Vision</a></span><span class="op">(</span><span class="va">scaled_counts</span>,
              signatures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"data/h.all.v5.2.symbols.gmt"</span><span class="op">)</span>,
              meta <span class="op">=</span> <span class="va">meta</span><span class="op">)</span></code></pre></div>
<p><strong>Expression Data</strong></p>
<p>The provided expression data should be scaled and normalized. The example above shows just a simple UMI-scaling, but it is recommended to apply more advanced normalization procedures such as batch correction or removal of technical confounders.</p>
<p>The expression data should not be log-transformed prior to loading into VISION.</p>
<p><strong>Signatures</strong></p>
<p>Signatures can be provided as a list of paths to signature files (*.gmt) or Signature objects.</p>
<p>See <a href="Signatures.html">the signature vignette</a> for more information on finding or creating gene Signatures.</p>
<p><strong>Meta Data</strong></p>
<p>An R data.frame with cell-level meta-data. This could be confounding variables (e.g. percentage of mitochondrial RNA, number of genes detected) or experimental covariates (e.g. genotype, donor, batch).</p>
<p>This input is optional if Signatures are provided.</p>
<p><strong>Other Options</strong></p>
<p>Other options and inputs can be provided to customize how VISION runs. For information on this, see the “Customizing VISION Analysis” section below.</p>
</div>
<div id="running-an-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#running-an-analysis" class="anchor"></a>Running an Analysis</h2>
<p>To run an analysis, simply call the analyze function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Set the number of threads when running parallel computations</span>
<span class="co"># On Windows, this must either be omitted or set to 1</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="va">vis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyze,Vision-method.html">analyze</a></span><span class="op">(</span><span class="va">vis</span><span class="op">)</span></code></pre></div>
</div>
<div id="viewing-results" class="section level2">
<h2 class="hasAnchor">
<a href="#viewing-results" class="anchor"></a>Viewing Results</h2>
<p>With the processed Vision object, a dynamic web report can be generated with the <code><a href="../reference/viewResults,Vision-method.html">viewResults()</a></code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/viewResults,Vision-method.html">viewResults</a></span><span class="op">(</span><span class="va">vis</span><span class="op">)</span></code></pre></div>
<p>This will launch a browser running the interactive report.</p>
<p>Other options (port, host, browser) can be provided to control how this occurs. For example, if you are launching a report on a remote server (such as an AWS instance) and want to make it accessible to others, run this with <code>host="0.0.0.0"</code>, some selected port number (e.g. <code>port=8888</code>), and <code>browser=FALSE</code> (so a browser isn’t auto-opened). Then the report should be available at “&lt;your instance IP address&gt;:8888”. (Note: You will also likely need to enable inbound traffic on your selected port for this to work correctly).</p>
<p>Alternately, you can work with the VISION object directly in R. For example:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Display autocorrelation coefficients, p-values for signatures</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/getSignatureAutocorrelation,Vision-method.html">getSignatureAutocorrelation</a></span><span class="op">(</span><span class="va">vis</span><span class="op">)</span><span class="op">)</span>


<span class="co"># Plot signature scores for a signature of interest</span>
<span class="va">tsne</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getProjections,Vision-method.html">getProjections</a></span><span class="op">(</span><span class="va">vis</span><span class="op">)</span><span class="op">[[</span><span class="st">"tSNE30"</span><span class="op">]</span><span class="op">]</span>
<span class="va">sigScores</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getSignatureScores,Vision-method.html">getSignatureScores</a></span><span class="op">(</span><span class="va">vis</span><span class="op">)</span><span class="op">[</span>, <span class="st">"HALLMARK_INTERFERON_GAMMA_RESPONSE"</span><span class="op">]</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">tsne</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, y<span class="op">=</span><span class="va">tsne</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, color<span class="op">=</span><span class="va">sigScores</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>For more details on accessing computed data within the VISION object, see the <a href="https://yoseflab.github.io/VISION/reference/index.html">References</a> page.</p>
</div>
<div id="customizing-the-latent-space" class="section level2">
<h2 class="hasAnchor">
<a href="#customizing-the-latent-space" class="anchor"></a>Customizing the Latent Space</h2>
<p>VISION requires a latent space to model the similarity between cells (used to determine a cell’s local neighborhood).</p>
<p>By default, this is calculated via PCA on a subset of the genes. A few arguments control this process:</p>
<ul>
<li>
<code>projection_genes</code> - controls how genes are selected for PCA. Options are:
<ul>
<li>
<code>"threshold"</code> - use a threshold to select genes. The <code>threshold</code> argument specifies either the number or proportion of genes in which a cell must be expressed to be included.</li>
<li>
<code>"fano"</code> - first the “threshold” filter is applied. Then genes are ordered by mean expression into 30 bins and within each bin, genes with a high Fano factor (2 MAD above the median) are retained</li>
<li>character vector of gene names - specify the genes to use directly</li>
</ul>
</li>
</ul>
<div id="specifying-a-custom-latent-space" class="section level3">
<h3 class="hasAnchor">
<a href="#specifying-a-custom-latent-space" class="anchor"></a>Specifying a Custom Latent Space</h3>
<p>Alternately, if a latent space has been computed elsewhere (either via PCA, or other factor analysis methods such as <a href="https://github.com/epierson9/ZIFA">ZIFA</a>, <a href="https://github.com/drisso/zinbwave">ZINB-WaVE</a> or <a href="https://github.com/YosefLab/scVI">scVI</a>) it can be provided via the <code>latentSpace</code> argument as a data frame.</p>
</div>
</div>
<div id="micropooling" class="section level2">
<h2 class="hasAnchor">
<a href="#micropooling" class="anchor"></a>Micropooling</h2>
<p>scRNA-seq experiments have grown in size over the past couple of years, and as such we have provided an algorithm for pooling together similar cells and continuing with analysis, thus reducing the cell-wise time complexity of the VISION pipeline. For more information, please see our micropooling vignette.</p>
<p>You can control the parameters of the micropooling algorithm using two arguments:</p>
<ul>
<li>
<code>pool</code> - boolean specifying whether or not to apply micropooling. By default this is set to ‘auto’ and micropooling is run when the number of cells exceeds 15,000.</li>
<li>
<code>cellsPerPartition</code> - integer specifying the target number of cells per micropool.</li>
</ul>
</div>
<div id="adding-2d-projections" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-2d-projections" class="anchor"></a>Adding 2d Projections</h2>
<p>Two-dimensional projections are used to visualize the data in the output report.</p>
<p>By default, VISION computes tSNE on the latent space for visualization. However, other options are availabled via the <code>projection_methods</code> argument.</p>
<p>Often times, users will have pre-computed projections that they would like to use for visualizing their data (e.g. a pre-computed tSNE, or UMAP projection). In this case, the <code><a href="../reference/addProjection,Vision-method.html">addProjection()</a></code> method can be used to add this view of the data to the output report.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">projection</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"umap_results.csv"</span><span class="op">)</span>

<span class="co"># projection is a matirx or data.frame of dimension (Cells x 2)</span>

<span class="va">vis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addProjection,Vision-method.html">addProjection</a></span><span class="op">(</span><span class="va">vis</span>, <span class="st">"UMAP"</span>, <span class="va">projection</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Matt Jones, David Detomaso, Tal Ashuach, Yanay Rosen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
